/*! @name @samueleastdev/videojs-dash-hls-bitrate-switcher @version 1.0.7 @license Apache-2.0 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("video.js")):"function"==typeof define&&define.amd?define(["video.js"],e):(t="undefined"!=typeof globalThis?globalThis:t||self).videojsDashHlsBitrateSwitcher=e(t.videojs)}(this,(function(t){"use strict";function e(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var r=e(t);function n(t,e,r){return t(r={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&r.path)}},r.exports),r.exports}var i=n((function(t){t.exports=function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t},t.exports.default=t.exports,t.exports.__esModule=!0})),o=n((function(t){function e(r,n){return t.exports=e=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},t.exports.default=t.exports,t.exports.__esModule=!0,e(r,n)}t.exports=e,t.exports.default=t.exports,t.exports.__esModule=!0})),a=n((function(t){t.exports=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,o(t,e)},t.exports.default=t.exports,t.exports.__esModule=!0})),s=function(t){function e(e,r){var n;return(n=t.call(this,e,r)||this).height=r.height,n.levels=r.levels,n.bitrate=r.bitrate,n.setAttribute("data-bitrate",r.bitrate),n}return a(e,t),e.prototype.handleClick=function(t){var e=this;this.parentComponent_.children_.forEach((function(t){t.removeClass("vjs-selected")})),this.addClass("vjs-selected"),this.levels.forEach((function(t){e.bitrate===t.bitrate?t.enabled=!0:t.enabled=!1}))},e}(r.default.getComponent("MenuItem"));r.default.registerComponent("PlayBackRatesBtn",s);var l=r.default.getPlugin("plugin"),u=r.default.getComponent("Component"),d=r.default.getComponent("MenuButton"),p={now:null,then:Date.now(),interval:1e3,frames:0,delta:null,showInfo:!1},h=function(t){function e(e,n){var o;o=t.call(this,e)||this;var a=i(o);return o.options=r.default.mergeOptions(p,n),o.player.ready((function(){o.player.addClass("vjs-dash-hls-bitrate-switcher"),o.options.showInfo&&a.buildUi()})),o.player.on("loadstart",(function(t){this.getChild("controlBar").getChild("RatesButton")&&(this.getChild("controlBar").removeChild("RatesButton"),a.qualityLevels.off("change")),this.one(r.default.browser.IS_IOS?"canplaythrough":"loadedmetadata",(function(t){["m3u8","mpd"].includes(a.getExtension(this.currentSrc()))&&(a.qualityLevels=this.qualityLevels(),a.qualityLevels.levels_.length>1&&a.init())}))})),o}a(e,t);var n=e.prototype;return n.getExtension=function(t){return t.split(/[#?]/)[0].split(".").pop().trim()},n.sortProperties=function(t){t=t.levels_;var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(t[r]);return e.sort((function(t,e){return e.hasOwnProperty("height")?t.height-e.height:e.hasOwnProperty("bandwidth")?t.bandwidth-e.bandwidth:void 0})),e.reverse()},n.formatBitrate=function(t){var e=-1;do{t/=1024,e++}while(t>1024);return Math.max(t,.1).toFixed(1)+[" kbps"," Mbps"," Gbps"," Tbps","Pbps","Ebps","Zbps","Ybps"][e]},n.formatRendition=function(t){return t.hasOwnProperty("height")?t.height?t.height+"p, "+this.formatBitrate(t.bitrate):"":""+this.formatBitrate(t.bitrate)},n.init=function(t){var e=this,n=function(t){function r(e,r){return t.call(this,e,r)||this}a(r,t);var n=r.prototype;return n.buildCSSClass=function(){return"vjs-icon-cog "+t.prototype.buildCSSClass.call(this)},n.buildWrapperCSSClass=function(){return"vjs-dash-hls-bitrate-switcher-menu "+t.prototype.buildWrapperCSSClass.call(this)},n.updateSelected=function(t){this.items.forEach((function(e){t.bitrate===parseInt(e.el().getAttribute("data-bitrate"))?e.addClass("vjs-selected"):e.removeClass("vjs-selected")}))},n.createItems=function(t){var r=this;void 0===t&&(t=[]);var n=e.sortProperties(e.qualityLevels);return n.forEach((function(i){i.bitrate&&t.push(new s(r.player(),{levels:n,label:""+e.formatRendition(i),bitrate:i.bitrate,type:i.bitrate}))})),t},r}(d);r.default.registerComponent("RatesButton",n);var i=e.player.getChild("controlBar").children().length;e.player.getChild("controlBar").getChild("fullscreenToggle")?e.player.getChild("controlBar").addChild("ratesButton",{},i-1):e.player.getChild("controlBar").addChild("ratesButton",{},i),e.qualityLevels.on("change",(function(){var t=e.qualityLevels[e.qualityLevels.selectedIndex];e.player.getChild("controlBar").getChild("ratesButton").updateSelected(t),e.player.getChild("streamInfo")&&e.player.getChild("streamInfo").updateTextContent('<div class="vjs-stream-info-box">Dimensions:'+t.width+"x"+t.height+"<br/>Bitrate:"+e.formatBitrate(t.bitrate)+"<br/>Renditions:"+e.qualityLevels.length+"<br/>Type:"+e.player.currentType()+"</div>")}));var o=e.qualityLevels[e.qualityLevels.selectedIndex];e.player.getChild("controlBar").getChild("ratesButton").updateSelected(o),e.player.getChild("streamInfo")&&e.player.getChild("streamInfo").updateTextContent('<div class="vjs-stream-info-box">Dimensions:'+o.width+"x"+o.height+"<br/>Bitrate:"+e.formatBitrate(o.bitrate)+"<br/>Renditions:"+e.qualityLevels.length+"<br/>Type:"+e.player.currentType()+"</div>")},n.buildUi=function(){var t=r.default.extend(u,{constructor:function(t,e){u.apply(this,arguments),e.text&&this.updateTextContent(e.text)},createEl:function(){return r.default.createEl("div",{className:"vjs-stream-info",innerHTML:""})},updateTextContent:function(t){"string"!=typeof t&&(t=""),this.el().innerHTML=t}});window.videojs=r.default,r.default.registerComponent("streamInfo",t),this.player.addChild("streamInfo",{text:""})},e}(l);return h.defaultState={},h.VERSION="1.0.7",r.default.registerPlugin("dashHlsBitrateSwitcher",h),h}));
