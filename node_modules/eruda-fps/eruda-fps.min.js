(function(t,i){if(typeof define==="function"&&define.amd){define([],i)}else if(typeof module==="object"&&module.exports){module.exports=i()}else{t.erudaFps=i()}})(this,function(){var t=window.innerWidth;return function(i){var e=t,a=192,s=12,n=8,r=12,l=40,h=t-24,f=142,c=2,o="FPS";var _=i.util,v=i.Settings,u=Math.round,d=i.Tool;var m=d.extend({name:"fps",init:function(t,i){this.callSuper(d,"init",arguments);this._style=_.evalCss([".eruda-fps {padding: 10px !important;}","canvas {width: 100%; border: 1px solid var(--border);}"].join(".eruda-fps "));this._container=i;this._isRunning=false;this._beginTime=_.now();this._prevTime=this._beginTime;this._frames=0;this._min=Infinity;this._max=0;this._alwaysActivated=true;this._appendTpl();this._initCanvas();this._initCfg()},show:function(){this._start();this.callSuper(d,"show",arguments)},hide:function(){if(!this._alwaysActivated)this._stop();this.callSuper(d,"hide",arguments)},destroy:function(){this._stop();_.evalCss.remove(this._style);this.callSuper(d,"destroy",arguments);this._rmCfg()},_rmCfg:function(){var t=this.config;var i=this._container.get("settings");if(!i)return;i.remove(t,"alwaysActivated").remove("Fps")},_start:function(){if(this._isRunning)return;var t=this;this._isRunning=true;function i(){if(!t._isRunning)return;t._update();requestAnimationFrame(i)}i()},_stop:function(){this._isRunning=false;this._beginTime=_.now();this._prevTime=this._beginTime;this._frames=0},_appendTpl:function(){this._$el.html("<canvas></canvas>");this._canvas=this._$el.find("canvas").get(0);this._ctx=this._canvas.getContext("2d")},_initCanvas:function(){var t=this._canvas;var i=this._ctx;var c=_.evalCss.getCurTheme();var v=c.background;var u=c.accent;t.width=e;t.height=a;i.font="bold 18px Helvetica,Arial,sans-serif";i.textBaseline="top";i.fillStyle=v;i.fillRect(0,0,e,a);i.fillStyle=u;i.fillText(o,s,n);i.fillRect(r,l,h,f);i.fillStyle=v;i.globalAlpha=.9;i.fillRect(r,l,h,f)},_initCfg:function(){var t=this._container;var i=this.config=v.createCfg("fps",{alwaysActivated:true});if(!i.get("alwaysActivated"))this._alwaysActivated=false;var e=this;i.on("change",function(t,i){switch(t){case"alwaysActivated":e._alwaysActivated=i;return}});var a=t.get("settings");a.text("Fps").switch(i,"alwaysActivated","Always Activated").separator()},_update:function(){this._frames++;var t=this._prevTime,i=_.now();if(i>t+1e3){this._draw(this._frames*1e3/(i-t),100);this._prevTime=i;this._frames=0}this._beginTime=i},_draw:function(t,i){this._min=Math.min(this._min,t);this._max=Math.max(this._max,t);var a=_.evalCss.getCurTheme();var v=a.background;var d=a.accent;var m=this._min;var p=this._max;var g=this._canvas;var w=this._ctx;w.fillStyle=v;w.globalAlpha=1;w.fillRect(0,0,e,l);w.fillStyle=d;w.fillText(u(t)+""+o+" ("+u(m)+"-"+u(p)+")",s,n);w.drawImage(g,r+c,l,h-c,f,r,l,h-c,f);w.fillRect(r+h-c,l,c,f);w.fillStyle=v;w.globalAlpha=.9;w.fillRect(r+h-c,l,c,u((1-t/i)*f))}});return new m}});